<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Car Sales Visualization</title>
    <!-- Import J3 library -->
    <script src="https://unpkg.com/j3@^1.1.0/dist/j3.min.js"></script>
  </head>
  <body>
    <div id="chart"></div>
    <script>
      // Data table
      var dataTable = j3.csvParse(`Model Year,Make,Model
2018,TESLA,MODEL 3
2020,TESLA,MODEL 3
2021,AUDI,E-TRON
2019,TESLA,MODEL 3
2014,FORD,C-MAX
2015,NISSAN,LEAF
2013,CHEVROLET,VOLT
2016,TESLA,MODEL S
2018,NISSAN,LEAF
2018,TESLA,MODEL 3
2016,TESLA,MODEL X
2018,CHEVROLET,BOLT EV
2020,KIA,NIRO
2018,NISSAN,LEAF
2019,TESLA,MODEL 3
2013,NISSAN,LEAF
2018,TESLA,MODEL 3
2017,FIAT,500
2015,NISSAN,LEAF
2019,TESLA,MODEL 3
2018,KIA,NIRO
2016,CHEVROLET,VOLT
2014,FORD,C-MAX
2020,NISSAN,LEAF
2018,TESLA,MODEL 3
2021,BMW,X5`);

      // Group data by year and count the number of cars sold each year
      var yearData = j3.nest()
        .key(function(d) { return d["Model Year"]; })
        .rollup(function(v) { return v.length; })
        .entries(dataTable);

      // Create a bar chart using J3
      var chart = j3.select("#chart")
        .append("svg")
        .attr("width", 500)
        .attr("height", 300);

      chart.selectAll("rect")
        .data(yearData)
        .enter()
        .append("rect")
        .attr("x", function(d, i) {
          return i * (500 / yearData.length);
        })
        .attr("y", function(d) {
          return 300 - (d.value * 10);
        })
        .attr("width", 500 / yearData.length - 2)
        .attr("height", function(d) {
          return d.value * 10;
        })
        .attr("fill", "steelblue");

      chart.selectAll("text")
        .data(yearData)
        .enter()
        .append("text")
        .text(function(d) {
          return d.value;
        })
        .attr("x", function(d, i) {
          return i * (500 / yearData.length) + (500 / yearData.length - 2) / 2;
        })
        .attr("y", function(d) {
          return 290 - (d.value * 10);
        })
        .attr("text-anchor", "middle")
        .attr("font-size", "12px")
        .attr("fill", "white");
    </script>
  </body>
</html>
